<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/iron-ajax/iron-ajax.html">

<link rel="import" href="shuvayatra-feed.html">
<link rel="import" href="shuvayatra-header.html">

<link rel="import" href="shuvayatra-audio-detail.html">
<link rel="import" href="shuvayatra-video-detail.html">
<link rel="import" href="shuvayatra-text-detail.html">

<dom-module id="shuvayatra-post">
<template>
    <style is="custom-style">
        :host{
            display: block;
        }

        shuvayatra-video-detail.content {
            padding: 0;
        }

        .content {
            padding: 20px 15px;
            text-rendering: optimizeLegibility !important;
            -webkit-font-smoothing: antialiased !important;
        }

        shuvayatra-text-detail, shuvayatra-audio-detail{
            margin-top: 200px;
        }

        @media only screen and (min-width: 1024px) {
            shuvayatra-text-detail, shuvayatra-audio-detail {
                margin-top: 300px;
            }
        }

        @media only screen and (min-width: 1600px) {
            shuvayatra-text-detail, shuvayatra-audio-detail {
                margin-top: 400px;
            }
        }
    </style>

    <iron-ajax id="ajax" auto
        url="{{ postUrl }}"
        method="GET"
        params="{{ queryParams }}"
        last-response="{{ data }}"
        loading="{{ isLoading }}">
    </iron-ajax>

    <template id="audioIf" is="dom-if" if="{{ _checkIfTypeAudio(data.type) }}">
        <shuvayatra-header id="player" post data="{{ data }}" has-feature-image audio download change-flag="{{ changeFlag }}"></shuvayatra-header>
        <shuvayatra-audio-detail id="detail" class="content" post="{{ data }}"></shuvayatra-audio-detail>
    </template>

    <template id="videoIf" is="dom-if" if="{{ _checkIfTypeVideo(data.type) }}">
        <shuvayatra-header post data="{{ data }}"  change-flag="{{ changeFlag }}"></shuvayatra-header>
        <shuvayatra-video-detail id="detail" class="content" post="{{ data }}"></shuvayatra-video-detail>
    </template>

    <template id="textIf" is="dom-if" if="{{ _checkIfTypeText(data.type) }}">
        <shuvayatra-header post has-feature-image data="{{ data }}" change-flag="{{ changeFlag }}"></shuvayatra-header>
        <shuvayatra-text-detail id="detail" class="content" post="{{ data }}"></shuvayatra-text-detail>
    </template>

    <div style="text-align:center;">
        <paper-spinner active="{{ isLoading }}"></paper-spinner>
    </div>

</template>
<script>
	Polymer({
        is: 'shuvayatra-post',
        behaviors: [GlobalBehavior],

        properties: {
        	postId:{
        		type: Number,
                observer: '_onIdChanged'
        	},

            postUrl:{
                type: String
            },

            changeFlag:{
                type: Boolean,
                observer: '_onCountsUpdated'
            }
        },

        _onCountsUpdated: function(){
            if(this._checkIfTypeText(this.data.type)){
                this.$.textIf.render();
            }else if(this._checkIfTypeVideo(this.data.type)){
                this.$.videoIf.render();
            } else if(this._checkIfTypeAudio(this.data.type)){
                this.$.audioIf.render();
            }
            if(this.$$("#detail")){
                this.$$("#detail")._updateCountData(this.data);
            }
        },


        _onIdChanged: function(id){
            this.$.audioIf.render();
            if(this.$$('#player')) this.$$('#player')._stopPlayback();
            this.postUrl = this.baseUrl + "api/posts/" + this.postId;
        },

        _checkIfTypeAudio: function(type){
            return (type === "audio");
        },

        _checkIfTypeVideo: function(type){
            return (type === "video");
        },

        _checkIfTypeText: function(type){
            return (type === "text");
        },

        _stopVideoPlayback: function(){
            if(this._checkIfTypeVideo(this.data.type)){
                this.$.videoIf.render();
                this.$$("#detail")._stopPlayback();
            }
        }
    });
</script>
</dom-module>
